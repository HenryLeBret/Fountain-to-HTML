<!DOCTYPE html>
<meta charset="utf-8">
<title>Test Suite</title>
<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.18.0.css">
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script src="https://code.jquery.com/qunit/qunit-2.18.0.js"></script>
  <script type="text/javascript" src="js/parser.js"></script>

  <script>

    const { test } = QUnit;

    QUnit.module( "Parsing", hooks => {
        let parser;

        let HEADING = [
            [ "EXT. BRICK'S POOL - DAY",
              { INT: false, EXT: true, location: ["BRICK'S POOL"], others: ["DAY"], line: "EXT. BRICK'S POOL – DAY" } ],
            [ ".SNIPER SCOPE POV",
              { INT: false, EXT: false, location: ["SNIPER SCOPE POV"], others: [], line: "SNIPER SCOPE POV" } ],
            [ "ext. brick's pool - day",
                { INT: false, EXT: true, location: ["brick's pool"], others: ["day"], line: "EXT. brick's pool – day" } ],
            [ "INT. HOUSE - DAY #1#    ",
                { INT: true, EXT: false, location: ["HOUSE"], others: ["DAY"], line: "INT. HOUSE – DAY #1#" } ],
            [ "Ext. HOUSE - DAY #1A#",
                { INT: false, EXT: true, location: ["HOUSE"], others: ["DAY"], line: "EXT. HOUSE – DAY #1A#" } ],
            [ "EST. HOUSE - DAY #1a#",
                { INT: false, EXT: true, location: ["HOUSE"], others: ["DAY"], line: "EXT. HOUSE – DAY #1a#"} ],
            [ "INT./EXT HOUSE - DAY #A1#",
                { INT: true, EXT: true, location: ["HOUSE"], others: ["DAY"], line: "INT/EXT. HOUSE – DAY #A1#"} ],
            [ "INT/EXT HOUSE - DAY #I-1-A#",
                { INT: true, EXT: true, location: ["HOUSE"], others: ["DAY"], line: "INT/EXT. HOUSE – DAY #I-1-A#" } ],
            [ "I/E HOUSE  -   DAY #1.#",
                { INT: true, EXT: true, location: ["HOUSE"], others: ["DAY"], line: "INT/EXT. HOUSE – DAY #1.#" } ],
            [ "INT. HOUSE - DAY - FLASHBACK (1944) #110A#    ",
                { INT: true, EXT: false, location: ["HOUSE"], others: ["DAY", "FLASHBACK (1944)"], line: "INT. HOUSE – DAY – FLASHBACK (1944) #110A#" } ],
            [ "EXT/INT  Espace/forêt/Appartement de HC - Nuit",
                { INT: true, EXT: true, location: ["Espace", "forêt", "Appartement de HC"], others: ["Nuit"], line: "INT/EXT. Espace/forêt/Appartement de HC – Nuit" } ],
            [ "EXT. STUDIO DE TOURNAGE - JOUR",
                { INT: false, EXT: true, location: ["STUDIO DE TOURNAGE"], others: ["JOUR"], line: "EXT. STUDIO DE TOURNAGE – JOUR"} ],
            [ ".Générique de fin",
                { INT: false, EXT: false, location: ["Générique de fin"], others: [], line: "Générique de fin"} ]
        ];

        let DIALOG = [
            [ "STEEL\nThe man's a myth!",
                { character: "STEEL", 'character-cue': "STEEL", block: "dialog", dialog: [
                    "The man's a myth!" ] } ],
            [ "MOM (O. S.)\nLuke! Come down for supper!",
                { character: "MOM", 'character-cue': "MOM (O. S.)", block: "dialog", dialog: [
                    "Luke! Come down for supper!" ] } ],
            [ "HANS (on the radio)\nWhat was it you said?",
                { character: "HANS", 'character-cue': "HANS (on the radio)", block: "dialog", dialog: [
                    "What was it you said?" ] } ],
            [ "@McCLANE\nYippie ki-yay! I got my lower-case C back!",
                { character: "McCLANE", 'character-cue': "McCLANE", block: "dialog", dialog: [
                    "Yippie ki-yay! I got my lower-case C back!" ] } ],
            [ "SANBORN\nA good 'ole boy. You know, loves the Army, blood runs green. Country boy. Seems solid.",
                { character: "SANBORN", 'character-cue': "SANBORN", block: "dialog", dialog: [
                    "A good 'ole boy. You know, loves the Army, blood runs green. Country boy. Seems solid." ] } ],
            [ "\tDAN\nThen let's retire them. \n_Permanently_.",
                { character: "DAN", 'character-cue': "DAN", block: "dialog", dialog: [
                    "Then let's retire them.", "_Permanently_." ] } ],
            [ "STEEL\n(starting the engine)\nSo much for retirement!",
                { character: "STEEL", 'character-cue': "STEEL", block: "dialog", dialog: [
                    "(starting the engine)", "So much for retirement!" ] } ],
            [ "STEEL ^\nScrew retirement.",
                { character: "STEEL", 'character-cue': "STEEL", block: "dual-dialog", dialog: [
                    "Screw retirement." ] } ],
            [ "WILLY WONKA\n~Willy Wonka! The amazing chocolatier!",
                { character: "WILLY WONKA", 'character-cue': "WILLY WONKA", block: "dialog", dialog: [
                    "~Willy Wonka! The amazing chocolatier!" ] } ],
            [ "     JYCR   (H.C.)\n   (énervé)\n  HC !\n",
                { character: "JYCR", 'character-cue': "JYCR (H.C.)", block: "dialog", dialog: [
                    "(énervé)", "HC !" ] } ],
            [ "HC\n(chuchote)\n…Longue vie et prospérité…[[SRC:humour:Spock]]",
                { character: "HC", 'character-cue': "HC", block: "dialog", dialog: [
                    "(chuchote)", "…Longue vie et prospérité…[[SRC:humour:Spock]]" ] } ],
            [ "JYCR\nNon, parce que je ne ferais pas le signe stupide avec la main.\n[[SRC:humour:Spock]]\n",
                { character: "JYCR", 'character-cue': "JYCR", block: "dialog", dialog: [
                    "Non, parce que je ne ferais pas le signe stupide avec la main.", "[[SRC:humour:Spock]]" ] } ],
            [ "JYCR (CONT’D)\nsauf les oiseaux.",
                { character: "JYCR", 'character-cue': "JYCR (CONT’D)", block: "dialog", dialog: [
                    "sauf les oiseaux." ] } ],
            [ "R2D2\nbibop",
                { character: "R2D2", 'character-cue': "R2D2", block: "dialog", dialog: [
                    "bibop" ] } ],
            // [ "",
            //     { character: "", 'character-cue': "", block: "dialog", dialog: [
            //         "" ] } ],
            //
        ];

        hooks.beforeEach( () => {
            parser = new FountainParser(undefined, undefined);
        });

        test.each( "isHeading", HEADING, ( assert, [data] ) => {
            assert.true(parser.isHeading(data), `${data} is Heading`);
        });

        test.each( "isHeading (escaped)", HEADING, ( assert, [data] ) => {
            assert.false(parser.isHeading('!' + data), `!${data} is not Heading`);
        });

        test.each( "! isHeading (DIALOG)", DIALOG, ( assert, [data] ) => {
            assert.false(parser.isHeading(data), `${data} is not Heading`);
        });

        test.each( "parseHeading", HEADING, ( assert, [data, expected] ) => {
            var actual = parser.parseHeading(data);
            assert.equal(actual.line, expected.line, `${actual.line} is correctly formated`);
            assert.equal(actual.INT, expected.INT, `INT ${actual.INT} is correct`);
            assert.equal(actual.EXT, expected.EXT, `EXT ${actual.EXT} is correct`);
            assert.deepEqual(actual.location, expected.location, `location of ${actual.line} is correct`);
        });

        test.each( "isDialog", DIALOG, ( assert, [data] ) => {
            assert.true(parser.isDialog(data), `${data} is Heading`);
        });

        test.each( "! isDialog (HEADING)", HEADING, ( assert, [data] ) => {
            assert.false(parser.isDialog(data), `${data} is Dialog`);
        });

        test( "! isDialog", (assert) => {
            assert.false(parser.isDialog("McCLANE\nYippie ki-yay!"), '"McCLANE\nYippie ki-yay!" is not Dialog');
        });

        test.each( "parseDialog", DIALOG, ( assert, [data, expected] ) => {
            var actual = parser.parseDialog(data);
            assert.equal(actual.character, expected.character, `${actual.character} is correctly formated`);
            assert.equal(actual['character-cue'], expected['character-cue'], `${actual['character-cue']} is correct`);
            assert.deepEqual(actual.dialog, expected.dialog, `${actual.dialog} is correct`);
            assert.equal(actual.block, expected.block, `${actual.block} is correct`);
        });

    });
  </script>
</body>
