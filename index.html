<!DOCTYPE html>
<html>
    <head>

        <title>Fountain to HTML</title>
        <link href="css/viewer.css" type="text/css" rel="stylesheet" />
        <link href="css/styles.css" type="text/css" rel="stylesheet" />
    </head>
    <body>

        <header>
            <h1 id="title">Untitled Screenplay</h1>
            <nav>
                <section>
                    <span id="word-count">0</span> words, 
                    <span id="scene-count">0</span> scenes, 
                    <span id="page-count">0</span> pages
                </section>              
                <div id="upload-file-wrapper">
                    <button>Upload</button>
                    <input type="file" name="upload-file" id="upload-file" />              
                </div>
                <button id="download-file">Download</button>
                <button onclick="window.print();">Print</button>
            </nav>     
        </header>

        <div id="editor">
            <textarea id="fountain" placeholder="Start writing your screenplay in Fountain here..."></textarea>
        </div>
        <div id="viewer">
            <ul id="scenario">
                <li><p class="message">Start writing your script in Fountain. More info on how to write Fountain can be found here: <a href="https://fountain.io/syntax" target="_blank">fountain.io/syntax</a>.</a></p></li>
            </ul>
        </div>

        <footer>
            <p>Programmed by <a href="https://www.timvervoort.com" target="_blank">Tim Vervoort</a></p>
        </footer>

        <script type="text/javascript" src="js/display.js"></script>
        <script type="text/javascript" src="js/parser.js"></script>
        <script type="text/javascript" src="js/screenplay.js"></script>
        <script type="text/javascript" src="js/FileSaver.js"></script><!-- github.com/eligrey/FileSaver.js -->
        <script type="text/javascript">

            var d = new DisplayScript();
            var p = new FountainParser('fountain', d);
            var sp = new Screenplay('fountain', p, d);

            // Upload Fountain script
		    document.getElementById('upload-file').addEventListener('change', function(e) {
		    	var file = document.getElementById('upload-file').files[0];
		    	var textType = /text.*/;
		    	if (file.type.match(textType)) {
		    		var reader = new FileReader();
		    		reader.onload = function(e) {
                        document.getElementById('fountain').value = reader.result;
                        p.parseFountain();
		    		}
		    		reader.readAsText(file);	
                }
                else {
		    		document.getElementById('fountain').value = "File not supported!";
		    	}
            });
            
            // Download Fountain script
            document.getElementById('download-file').addEventListener('click', function(e) {
                var content = document.getElementById('fountain').value;
                var filename = 'screenplay.fountain.txt';
                var blob = new Blob([content], {
                    type: "text/plain;charset=utf-8"
                });
                saveAs(blob, filename);
            });

            function updateTitle(title) {
                document.getElementById('title').innerText = title;
            }

            function updateStats() {
                document.getElementById('page-count').innerText = document.getElementById('scenario').children.length;
                document.getElementById('scene-count').innerText = document.getElementsByClassName('heading').length;
                document.getElementById('word-count').innerText = document.getElementById('fountain').value.trim().split(/\s+/).length;
            }
           
        </script>

    </body>
</html>